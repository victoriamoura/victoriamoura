class CollectionGrid extends HTMLElement{constructor(){super()}connectedCallback(){this.boxLoadingPage=document.querySelector(".loading-products"),this.apiProducts="https://us-central1-insider-integrations.cloudfunctions.net/front-end-api-interviews/v1/products",this.getProducts()}async getProducts(){try{var t=await fetch(this.apiProducts,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Erro na requisição: "+t.status);var e=(await t.json()).data;e&&0<e.length?e.forEach(t=>{t.tag=t.sku.inventory<parseFloat(15)?"show":"visibility-hidden",t.price=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.sku.price),this.pagePopulate(t)}):console.error("Nenhum produto encontrado.")}catch(t){console.error("Erro ao buscar os dados:",t)}finally{setTimeout(()=>{this.boxLoadingPage.classList.add("visibility-hidden"),setTimeout(()=>{this.boxLoadingPage.remove()},500)},500)}}pagePopulate(t){this.innerHTML+=`
      <product-module class="collection__product-module" role="listitem">
        <picture class="collection__product-module__picture js-product-image">
          <div class="tag js-tag ${t.tag}">últimas unidades</div>
          <img class="js-product-image-elem" src="${t.image_url}&width=317" width="317px" alt="${t.name}" data-image-full="${t.image_url}">
        </picture>
        <h4 class="collection__product-module__title js-product-title">${t.name}</h4>
        <p class="collection__product-module__price js-product-price">${t.price}</p>
        <button
          type="button"
          class="btn collection__product-module__button js-add-to-cart"
          data-id="${t.id}"
          data-sku="${t.sku.id}"
          data-name="${t.name}"
          data-price="${t.sku.price}"
          data-image="${t.image_url}"
        >comprar</button>
      </product-module>
    `}}customElements.define("collection-grid",CollectionGrid);class ProductModule extends HTMLElement{constructor(){super()}connectedCallback(){this.btnAddToCart=this.querySelector(".js-add-to-cart"),this.productId=this.btnAddToCart.getAttribute("data-id"),this.productSku=this.btnAddToCart.getAttribute("data-sku"),this.productName=this.btnAddToCart.getAttribute("data-name"),this.productImage=this.btnAddToCart.getAttribute("data-image"),this.productPrice=parseFloat(this.btnAddToCart.getAttribute("data-price")),this.btnAddToCart.addEventListener("click",this.addToCart.bind(this))}addToCart(){var t={id:this.productId,sku:this.productSku,name:this.productName,price:this.productPrice,image:this.productImage,quantity:1};this.updateCart(t)}updateCart(e){var t=JSON.parse(localStorage.getItem("cart"))||[],i=t.find(t=>t.id===e.id);i?i.quantity+=1:t.push(e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t)}updateCartUI(t){var r=document.querySelector("cart-side"),a=document.querySelector(".js-cart-bubble");if(r){let e=r.querySelector(".js-cart-items");e.innerHTML="";let i={id:"gift001",sku:"brinde",name:"Spectrum Socks Low 2.0",price:0,image:"https://www.insiderstore.com.br/cdn/shop/files/preto02.jpg?v=1698679291&width=84",quantity:1};var s,c=t.find(t=>t.id===i.id),c=(250<=(s=t.reduce((t,e)=>e.id!==i.id?t+e.price*e.quantity:t,0))&&!c?t.unshift(i):s<250&&c&&(t=t.filter(t=>t.id!==i.id)),t.forEach(t=>{e.innerHTML+=`
          <div class="cart-item" data-id="${t.id}" data-sku="${t.sku}">
            <button class="cart-item__rmv-all" data-id="${t.id}">remover</button>
            <picture class="cart-item__picture">
              <img src="${t.image}&width=82" width="82px" alt="Produto ${t.id}">
            </picture>
            <div class="cart-item__infos">
              <h4 class="cart-item__infos__name">${t.name}</h4>
              <p class="cart-item__infos__brinde visibility-hidden">brinde</p>
              <p class="cart-item__infos__price">${Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)}</p>
              <div class="cart-item__infos__quantity">
                <button class="cart-item__infos__quantity-rmv" data-id="${t.id}">
                  <svg width="6" height="2" viewBox="0 0 6 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.96 1.464V0.456H5.76V1.464H0.96Z"/>
                  </svg>
                </button>
                <span class="cart-item__infos__quantity-curr">${t.quantity}</span>
                <button class="cart-item__infos__quantity-add" data-id="${t.id}">
                  <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.112 7.896V4.744H0.96V3.736H4.112V0.584H5.12V3.736H8.264V4.744H5.12V7.896H4.112Z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        `}),a.textContent=t.length,r.cartFooterTotalElem.textContent=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),r.querySelector(".js-cart-empty")),a=r.querySelector(".js-cart-footer");0===t.length?(c.classList.remove("visibility-hidden"),a.classList.add("visibility-hidden"),e.classList.add("visibility-hidden")):(c.classList.add("visibility-hidden"),a.classList.remove("visibility-hidden"),e.classList.remove("visibility-hidden")),this.attachCartListeners(t)}}attachCartListeners(t){var e=document.querySelector("cart-side"),i=e.querySelectorAll(".cart-item__infos__quantity-add"),r=e.querySelectorAll(".cart-item__infos__quantity-rmv"),e=e.querySelectorAll(".cart-item__rmv-all");i.forEach(r=>{r.addEventListener("click",()=>{let e=r.dataset.id;var t=JSON.parse(localStorage.getItem("cart"))||[],i=t.find(t=>t.id===e);i&&(i.quantity+=1,localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t))})}),r.forEach(r=>{r.addEventListener("click",()=>{let e=r.dataset.id,t=JSON.parse(localStorage.getItem("cart"))||[];var i=t.find(t=>t.id===e);i&&(1<i.quantity?--i.quantity:t=t.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t))})}),e.forEach(i=>{i.addEventListener("click",()=>{let e=i.dataset.id,t=JSON.parse(localStorage.getItem("cart"))||[];t=t.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t)})})}}customElements.define("product-module",ProductModule);class CartSide extends HTMLElement{constructor(){super()}connectedCallback(){this.apiCarts="https://us-central1-insider-integrations.cloudfunctions.net/front-end-api-interviews/v1/carts",this.cartContentElem=this.querySelector(".js-cart-content"),this.cartItemsElem=this.cartContentElem.querySelector(".js-cart-items"),this.cartEmptyElem=this.cartContentElem.querySelector(".js-cart-empty"),this.cartFooterElem=this.cartContentElem.querySelector(".js-cart-footer"),this.cartFooterTotalElem=this.cartFooterElem.querySelector(".js-cart-total"),this.cartFooterBtnElem=this.cartFooterElem.querySelector(".js-cart-btn"),this.cartFooterBtnElem.addEventListener("click",this.finalizePurchase.bind(this)),this.headerCloseCartBtn=this.querySelector(".js-cart-close"),this.headerCloseCartBtn.addEventListener("click",()=>{this.classList.remove("cart-opened"),document.body.classList.remove("no-scroll")}),document.querySelector(".js-open-cart").addEventListener("click",()=>{this.classList.add("cart-opened"),document.body.classList.add("no-scroll")}),this.render()}render(){var t=JSON.parse(localStorage.getItem("cart"))||[];0===t.length?(this.cartEmptyElem.classList.remove("visibility-hidden"),this.cartFooterElem.classList.add("visibility-hidden"),this.cartItemsElem.classList.add("visibility-hidden")):(this.cartEmptyElem.classList.add("visibility-hidden"),this.cartFooterElem.classList.remove("visibility-hidden"),this.cartItemsElem.classList.remove("visibility-hidden"),this.updateCartUI(t))}updateCartUI(t){var e=document.querySelector(".js-cart-bubble");this.cartItemsElem.innerHTML="";let i={id:"gift001",sku:"brinde",name:"Spectrum Socks Low 2.0",price:0,image:"https://www.insiderstore.com.br/cdn/shop/files/preto02.jpg?v=1698679291&width=84",quantity:1};var r,a=t.find(t=>t.id===i.id);250<=(r=t.reduce((t,e)=>e.id!==i.id?t+e.price*e.quantity:t,0))&&!a?t.unshift(i):r<250&&a&&(t=t.filter(t=>t.id!==i.id)),t.forEach(t=>{this.cartItemsElem.innerHTML+=`
        <div class="cart-item" data-id="${t.id}" data-sku="${t.sku}">
          <button class="cart-item__rmv-all" data-id="${t.id}">remover</button>
          <picture class="cart-item__picture">
            <img src="${t.image}&width=82" width="82px" alt="Produto ${t.id}">
          </picture>
          <div class="cart-item__infos">
            <h4 class="cart-item__infos__name">${t.name}</h4>
            <p class="cart-item__infos__brinde visibility-hidden">brinde</p>
            <p class="cart-item__infos__price">${Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)}</p>
            <div class="cart-item__infos__quantity">
              <button class="cart-item__infos__quantity-rmv" data-id="${t.id}">
                <svg width="6" height="2" viewBox="0 0 6 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.96 1.464V0.456H5.76V1.464H0.96Z"/>
                </svg>
              </button>
              <span class="cart-item__infos__quantity-curr">${t.quantity}</span>
              <button class="cart-item__infos__quantity-add" data-id="${t.id}">
                <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4.112 7.896V4.744H0.96V3.736H4.112V0.584H5.12V3.736H8.264V4.744H5.12V7.896H4.112Z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      `}),e.textContent=t.length,this.cartFooterTotalElem.textContent=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r),this.attachCartListeners(t)}attachCartListeners(r){var t=this.cartItemsElem.querySelectorAll(".cart-item__infos__quantity-add"),e=this.cartItemsElem.querySelectorAll(".cart-item__infos__quantity-rmv"),i=this.cartItemsElem.querySelectorAll(".cart-item__rmv-all");t.forEach(i=>{i.addEventListener("click",()=>{let e=i.dataset.id;var t=r.find(t=>t.id===e);t&&(t.quantity+=1,localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r))})}),e.forEach(i=>{i.addEventListener("click",()=>{let e=i.dataset.id;var t=r.find(t=>t.id===e);t&&(1<t.quantity?--t.quantity:r=r.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r))})}),i.forEach(t=>{t.addEventListener("click",()=>{let e=t.dataset.id;r=r.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r)})})}finalizePurchase(){var t=JSON.parse(localStorage.getItem("cart"))||[];0!==t.length&&(t={products:t.map(t=>({product:t.id,sku:t.sku,quantity:t.quantity}))},console.log(this.apiCarts),fetch(this.apiCarts,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)return t.json();throw new Error("Erro ao finalizar compra: "+t.status)}).then(t=>{document.querySelector(".js-modal-order-success").classList.remove("visibility-hidden"),localStorage.removeItem("cart")}).catch(t=>{document.querySelector(".js-modal-order-error").classList.remove("visibility-hidden")}))}}customElements.define("cart-side",CartSide);let closeModalButtons=document.querySelectorAll(".js-close-modal");closeModalButtons.forEach(function(t){t.addEventListener("click",function(){document.querySelectorAll(".modal-alert").forEach(function(t){window.location.reload(!0)})})}),document.addEventListener("DOMContentLoaded",()=>{var t=document.querySelector("cart-side");t&&t.render()});