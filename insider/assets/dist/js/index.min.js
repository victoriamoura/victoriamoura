let apiCarts="https://us-central1-insider-integrations.cloudfunctions.net/front-end-api-interviews/v1/carts";class CollectionGrid extends HTMLElement{constructor(){super()}connectedCallback(){this.boxLoadingPage=document.querySelector(".loading-products"),this.apiProducts="https://us-central1-insider-integrations.cloudfunctions.net/front-end-api-interviews/v1/products",this.getProducts()}async getProducts(){try{var t=await fetch(this.apiProducts,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Erro na requisição: "+t.status);var e=(await t.json()).data;e&&0<e.length?e.forEach(t=>{t.tag=t.sku.inventory<parseFloat(15)?"show":"hidden",this.pagePopulate(t)}):console.error("Nenhum produto encontrado.")}catch(t){console.error("Erro ao buscar os dados:",t)}finally{setTimeout(()=>{this.boxLoadingPage.classList.add("hidden"),setTimeout(()=>{this.boxLoadingPage.remove()},1e3)},2e3)}}pagePopulate(t){var e,a=document.querySelector(".js-collection");a&&(e=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.sku.price),a.innerHTML+=`
      <product-module class="collection__product-module">
        <picture class="collection__product-module__picture js-product-image">
          <div class="tag js-tag ${t.tag}">últimas unidades</div>
          <img class="js-product-image-elem" src="${t.image_url}" alt="${t.name}" data-image-full="${t.image_url}">
        </picture>
        <p class="collection__product-module__title js-product-title">${t.name}</p>
        <p class="collection__product-module__price js-product-price">${e}</p>
        <button
          type="button"
          class="btn collection__product-module__button js-add-to-cart"
          data-id="${t.id}"
          data-sku="${t.sku.id}"
          data-name="${t.name}"
          data-price="${t.sku.price}"
          data-image="${t.image_url}"
        >comprar</button>
      </product-module>
    `)}}customElements.define("collection-grid",CollectionGrid);class ProductModule extends HTMLElement{constructor(){super()}connectedCallback(){this.btnAddToCart=this.querySelector(".js-add-to-cart"),this.init()}init(){this.btnAddToCart.addEventListener("click",this.addToCart.bind(this))}addToCart(){var t=this.btnAddToCart.getAttribute("data-id"),e=this.btnAddToCart.getAttribute("data-sku"),a=this.btnAddToCart.getAttribute("data-name"),r=parseFloat(this.btnAddToCart.getAttribute("data-price")),i=this.btnAddToCart.getAttribute("data-image");this.updateCart({id:t,sku:e,name:a,price:r,image:i,quantity:1})}updateCart(e){var t=JSON.parse(localStorage.getItem("cart"))||[],a=t.find(t=>t.id===e.id);a?a.quantity+=1:t.push(e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t)}updateCartUI(t){var r=document.querySelector("cart-side");if(r){let e=r.querySelector(".js-cart-items"),a=(e.innerHTML="",0);t.forEach(t=>{e.innerHTML+=`
          <div class="cart-item" data-id="${t.id}">
            <button class="cart-item__rmv-all" data-id="${t.id}">remover</button>
            <picture class="cart-item__picture">
              <img src="${t.image}" alt="Produto ${t.id}">
            </picture>
            <div class="cart-item__infos">
              <p class="cart-item__infos__name">${t.name}</p>
              <p class="cart-item__infos__price">${Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)}</p>
              <div class="cart-item__infos__quantity">
                <button class="cart-item__infos__quantity-rmv" data-id="${t.id}">
                  <svg width="6" height="2" viewBox="0 0 6 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.96 1.464V0.456H5.76V1.464H0.96Z"/>
                  </svg>
                </button>
                <span class="cart-item__infos__quantity-curr">${t.quantity}</span>
                <button class="cart-item__infos__quantity-add" data-id="${t.id}">
                  <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.112 7.896V4.744H0.96V3.736H4.112V0.584H5.12V3.736H8.264V4.744H5.12V7.896H4.112Z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        `,a+=t.price*t.quantity}),r.footerTotal.textContent=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);var i=r.querySelector("#cart-empty");0===t.length?(i.removeAttribute("hidden"),r.footer.hidden=!0):(i.setAttribute("hidden","true"),r.footer.hidden=!1),this.attachCartListeners(t)}}finalizePurchase(){var t=JSON.parse(localStorage.getItem("cart"))||[];0!==t.length&&(t={products:t.map(t=>({product:t.id,sku:t.sku,quantity:t.quantity}))},fetch(apiCarts,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(t=>{if(t.ok)return t.json();throw new Error("Erro ao finalizar compra: "+t.status)}).then(t=>{document.querySelector(".js-modal-order-success").style.display="flex",localStorage.removeItem("cart")}).catch(t=>{document.querySelector(".js-modal-order-error").style.display="flex"}))}attachCartListeners(t){var e=document.querySelector("cart-side"),a=e.querySelectorAll(".cart-item__infos__quantity-add"),r=e.querySelectorAll(".cart-item__infos__quantity-rmv"),e=e.querySelectorAll(".cart-item__rmv-all");a.forEach(r=>{r.addEventListener("click",()=>{let e=r.dataset.id;var t=JSON.parse(localStorage.getItem("cart"))||[],a=t.find(t=>t.id===e);a&&(a.quantity+=1,localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t))})}),r.forEach(r=>{r.addEventListener("click",()=>{let e=r.dataset.id,t=JSON.parse(localStorage.getItem("cart"))||[];var a=t.find(t=>t.id===e);a&&(1<a.quantity?--a.quantity:t=t.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t))})}),e.forEach(a=>{a.addEventListener("click",()=>{let e=a.dataset.id,t=JSON.parse(localStorage.getItem("cart"))||[];t=t.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(t)),this.updateCartUI(t)})})}}customElements.define("product-module",ProductModule);class CartSide extends HTMLElement{constructor(){super(),this.content=document.querySelector(".js-cart-content"),this.cartItemsContainer=document.createElement("div"),this.cartItemsContainer.classList.add("js-cart-items","cart-content__list-items"),this.footer=document.createElement("div"),this.footer.classList.add("cart-footer"),this.footerTotal=document.createElement("p"),this.footerTotal.classList.add("cart-footer__total"),this.footerBtn=document.createElement("button"),this.footerBtn.textContent="finalizar compra",this.footerBtn.classList.add("js-buy-products","btn"),this.emptyMessage=document.createElement("p"),this.emptyMessage.id="cart-empty",this.emptyMessage.innerHTML=`
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <rect width="64" height="64" fill="url(#pattern0_1_438)"/>
        <defs>
        <pattern id="pattern0_1_438" patternContentUnits="objectBoundingBox" width="1" height="1">
          <use xlink:href="#image0_1_438" transform="scale(0.0104167)"/>
        </pattern>
        <image id="image0_1_438" width="96" height="96" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEA0lEQVR4nO2dz0tVQRTHv5UZFf0QiTZWEASRBilkf0FECkmLFq2UFhHZMtu3ChRDUYooUpD6C7JNaRshCGpjFgWly4qQ0soSa2JgHshD3z3v3rkzZ+aeDxx4mzf3O/O9d+49586bBwiCIAhCOKiEEMSAuFFyBYgBufIFwPyqWCGcdR8BbIQbVOxXwDKhk2tFuyN9KnYD/qQ04LEjfSp2A36nNOAfgEMO9KnYDfiV0gAdfQ70qdgN+JnBAH3T3pazPhW7AYsZDNDRVRADzgHYz9GAV4jfgAYzU+gHlkEAu2w2vhtA3aoon1KuEQahtYrjKc+RhrGyNnTudBlADRxQD2ApoVOjERtwDMDfddp6Z6am3BlN6NSSMSpGA54R2jyLnGkliOiJ0IAOQntvXE1FLxKEzAHYFJEBNQBmCO2dhiO6LNWHVCAGdBPamoRDtgL4miBoPBIDdgD4lNCOvjG3wDF9FupDKgADbhDauQ8PHKzwSFaKXsvHVJamlGqTrkrH1PWzffDEuOP6kHJsQHnStVZch0faHdeHlEMDKiVdpfgMYCc8sgHA+wSRLwM14CnheBfBgB6C0OOBGdDBKelKoo5woxoJyIAabkmXjfqQftW5JxADurklXRRaLNaHfBrANulyWR/yaQDbpMtWfaiNsQEN3JOuJLaYt0OVOvCIsQFj3JMuCr05rx9SORkQRNJF4QBhPant+lChki6O9aGsnAkp6aLQRuhQJ3gQZNLFrT5UuKSLW32okEkXp/pQIZMuCiOEpKbek7bgky4KzYQz7KonbVEkXTbqQ4ppBJF0UehkMJgqRQSTdNmoDylmEVTSReEug0FVVUTWii0r9prSgwok7iEyHjIYVEWM52bJZTScYjCoihC6RH7H3K+iQZ9JHxgMrlonvpl61BCAw4gQSpo/C2C7b6Ex0kTcc6Ldt9AY0bumTBEG/4FvobFygTD48+bxVMjh7J8tUprPjROEwZ9yuLlT4biUMPjL5gYteHoNqZ+5hRw5zyDBUjkHaygrpEMP9lDW2IQc7LnCYJBUkQ3Qj5gTDAZKFdWA0pKPtwwGSxXVgNLOW0mLdFWAERwnTeFtLsOmsIpRCIIgCEIwHDWbm74G8MOE/jzApDLKXV9q9BKPWwm/PFwBMAygVvTZH/zJKh7tJhybwF1fZm6neL4eEn325tSkHzyvNx01OjCBu77MDGbIMm+KPr/vA6YdGMBdn9f/H1gQfdlZyGDAdwcGcNcX/SU+w1xfZgYydLBf9GWnifj3h6os9HeOODCAuz4rDKfo4KDos0ctcQMkZeIJgM0ODeCuz1onhxIu9xVz5vvoHHd91mg0Ge60yREWzed+JnMqd32CIAiCIAiCICAu/gP3SA7LiMz4egAAAABJRU5ErkJggg=="/>
        </defs>
      </svg>
      <p>Seu carrinho está vazio.</p>
    `,this.emptyMessage.setAttribute("hidden","true"),this.content.appendChild(this.cartItemsContainer),this.content.appendChild(this.emptyMessage),this.content.appendChild(this.footer),this.footer.appendChild(this.footerTotal),this.footer.appendChild(this.footerBtn)}connectedCallback(){this.render(),this.querySelector(".js-buy-products").addEventListener("click",()=>{document.querySelector("product-module").finalizePurchase()}),document.querySelector(".js-open-cart").addEventListener("click",()=>{this.classList.add("cart-opened")}),this.closeCartBtn=this.querySelector(".js-cart-close"),this.closeCartBtn.addEventListener("click",()=>{this.classList.remove("cart-opened")})}render(){var t=JSON.parse(localStorage.getItem("cart"))||[];0===t.length?(this.emptyMessage.removeAttribute("hidden"),this.footer.hidden=!0):(this.emptyMessage.setAttribute("hidden","true"),this.footer.hidden=!1,this.updateCartUI(t))}updateCartUI(t){this.cartItemsContainer.innerHTML="";let e=0;t.forEach(t=>{this.cartItemsContainer.innerHTML+=`
        <div class="cart-item" data-id="${t.id}">
          <button class="cart-item__rmv-all" data-id="${t.id}">remover</button>
          <picture class="cart-item__picture">
            <img src="${t.image}" alt="Produto ${t.id}">
          </picture>
          <div class="cart-item__infos">
            <p class="cart-item__infos__name">${t.name}</p>
            <p class="cart-item__infos__price">${Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.price)}</p>
            <div class="cart-item__infos__quantity">
              <button class="cart-item__infos__quantity-rmv" data-id="${t.id}">
                <svg width="6" height="2" viewBox="0 0 6 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M0.96 1.464V0.456H5.76V1.464H0.96Z"/>
                </svg>
              </button>
              <span class="cart-item__infos__quantity-curr">${t.quantity}</span>
              <button class="cart-item__infos__quantity-add" data-id="${t.id}">
                <svg width="9" height="8" viewBox="0 0 9 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4.112 7.896V4.744H0.96V3.736H4.112V0.584H5.12V3.736H8.264V4.744H5.12V7.896H4.112Z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      `,e+=t.price*t.quantity}),this.footerTotal.textContent=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),this.attachCartListeners(t)}attachCartListeners(r){var t=this.cartItemsContainer.querySelectorAll(".cart-item__infos__quantity-add"),e=this.cartItemsContainer.querySelectorAll(".cart-item__infos__quantity-rmv"),a=this.cartItemsContainer.querySelectorAll(".cart-item__rmv-all");t.forEach(a=>{a.addEventListener("click",()=>{let e=a.dataset.id;var t=r.find(t=>t.id===e);t&&(t.quantity+=1,localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r))})}),e.forEach(a=>{a.addEventListener("click",()=>{let e=a.dataset.id;var t=r.find(t=>t.id===e);t&&(1<t.quantity?--t.quantity:r=r.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r))})}),a.forEach(t=>{t.addEventListener("click",()=>{let e=t.dataset.id;r=r.filter(t=>t.id!==e),localStorage.setItem("cart",JSON.stringify(r)),this.updateCartUI(r)})})}}customElements.define("cart-side",CartSide);